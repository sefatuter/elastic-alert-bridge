# rules/test_frequency.yaml

name: Test ERROR Frequency
type: frequency

# point at the index you created
index: test-index

# fire on every ERROR document
num_events: 1
timeframe:
  minutes: 60

# use the "timestamp" field you set on your documents
timestamp_field: timestamp

filter:
  - term:
      level.keyword: "ERROR"

# Elasticsearch client timeout (optional)
es:
  search_timeout: 30

# 1) send an HTTP POST...
alert:
  - "post"
  - debug

# Configuration for the 'post' alerter
http_post_url: "http://localhost:8000/api/eab/alert"

# static fields to include in that POST payload
http_post_payload:
  rule_id: "{{ rule_name }}"
  level: "{{ match.level }}"
  summary: "{{ match.message }}"
  host:  "{{ match.host | default('unknown') }}"

# allow re-alerting immediately (0 minute cooldown)
realert:
  minutes: 0
